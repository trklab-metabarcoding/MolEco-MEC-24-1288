{
  "hash": "a924b444dde0756b51fe3c543964bc31",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Fetching taxonomic data from ITIS\"\nformat: html\n---\n\n\n\n\nThis notebook contaions code to fetch family names from ITIS and then create lists of species in each family found in ITIS across the total 730 plant families. The final result here is one file called `allFamNames.csv`.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n## First check for the required packages, install if needed, and load the libraries.\nif (!requireNamespace(\"BiocManager\", quietly = TRUE))\n    install.packages(\"BiocManager\")\n\nBiocManager::install(\"sangerseqR\")\nremotes::install_github(\"ropensci/bold\")\nremotes::install_github(\"ropensci/taxize\")\n\nif (!require(\"pacman\")) install.packages(\"pacman\")\npacman::p_load(maps, ggplot2, dplyr, countrycode, data.table, raster)\n```\n:::\n\n\n\n\n## Step 1: Retrieve taxonomic information for families within the plant clade Embryophyta (multicellular plants, excluding green algae) using the ITIS database.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Retrieve families under \"Embryophyta\"\nfamnames <- taxize::downstream(\"Embryophyta\", db = \"itis\", downto = \"family\") \n# Embryophyta is multicellular plants (excluding green algae)\nfams <- famnames$Embryophyta$taxonname\n# Remove family with problematic records\nfams <- fams[fams != \"Kahukaloaceae\"]\n\n# Initialize data structures\nfamlist <- vector(\"list\", length(fams))\nfamout <- matrix(nrow = length(fams), ncol = 3)\nfamout[,1] <- fams\nlength(fams)\n```\n:::\n\n\n\n\n#### We found 730 families returned from ITIS.\n\n### Next we can loop over these families and generate CSV files with all the species in these families.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Loop over families and save a CSV for each\n\tfor(i in 1:length(fams)){\n\t\tfamlist[[i]] <- taxize::downstream(fams[i], db = \"itis\", downto = \"species\")\n\t\tfilename <- paste0(\"../data/family_csvs/\",fams[i],\".csv\",sep = \"\")\n\t\tfamout[i,2] <- filename\n\t\twrite.csv(file = filename, do.call(rbind, famlist[[i]]))\n\t\tfamout[i,3] <- length(which(do.call(rbind, famlist[[i]])$rankname == \"species\"))\n\t}\n```\n:::\n\n\n\n\n### Reassemble data from saved CSV files:\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nout3 <- vector(\"list\", length(fams)) \n  for(i in 1:length(fams)){ \n    filename <- paste0(\"./data/family_csvs/\",fams[i],\".csv\",sep=\"\") \n    if (file.exists(filename)) out3[[i]] <- read.csv(filename) }\n```\n:::\n\n\n\n\n### Combine all data into a single data frame\n\nThis block generates the list of families used in the [Correlations between plant species and DNA barcode availability](taxonomic_coverage.qmd) notebook.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nout4 <- do.call(rbind, out3)\ndim(out4)\nout4$family<-do.call(rbind, lapply(strsplit(as.character(out4$X), \"[.]\"), `[[`, 1)) # extract family names\nhead(out4, 2)\nwrite.csv(file=\"../data/allFamNames.csv\", out4) \n```\n:::\n",
    "supporting": [
      "fetch_itis_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}